<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project & Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Core Layout & Background --- */
        body { 
            font-family: 'Inter', sans-serif; 
            overflow: hidden;
        }
        .background-container { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh; 
            background-size: 400% 400%; 
            animation: gradientAnimation 15s ease infinite; 
            transition: background-image 0.5s ease-in-out; 
            z-index: -1; 
        }
        .theme-rainbow .background-container { background-image: linear-gradient(45deg, #4f46e5, #9333ea, #db2777, #f59e0b); }
        .theme-dark-mono .background-container { background-image: linear-gradient(45deg, #232526, #414345, #232526); }
        @keyframes gradientAnimation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        .main-container { 
            height: 100vh; 
            overflow-y: auto;
            padding-top: 4rem;
        }

        /* --- Glassmorphism Styles --- */
        .glass-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .glass-input, .glass-select, .glass-textarea {
            background: rgba(255, 255, 255, 0.15) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            color: #ffffff !important;
            border-radius: 0.375rem;
            padding-left: 0.75rem;
            padding-right: 0.75rem;
        }
        .glass-input::placeholder, .glass-textarea::placeholder { color: rgba(255, 255, 255, 0.7); }
        .glass-input:focus, .glass-select:focus, .glass-textarea:focus { box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.5); outline: none; }

        select option {
            background-color: #1f2937;
            color: #ffffff;
        }

        /* --- App-Specific Styles --- */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
        }
        .tab-btn { color: rgba(255, 255, 255, 0.7); }
        .tab-btn.active { color: #ffffff; border-color: #ffffff; }
        .tab-btn:hover { color: #ffffff; }

        .task-item {
            position: relative;
            overflow: hidden;
            padding-left: 1.5rem; 
        }
        .task-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 8px;
        }
        .task-item.priority-1::before { background-color: #ef4444; } /* High */
        .task-item.priority-2::before { background-color: #f97316; } /* Medium */
        .task-item.priority-3::before { background-color: #22c55e; } /* Low */
        .task-item.completed .task-title { text-decoration: line-through; color: rgba(255, 255, 255, 0.5); }
        
        .status-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
        .status-lead { background-color: #3b82f6; color: white; }
        .status-dp-in-progress { background-color: #f97316; color: white; }
        .status-bp-in-progress { background-color: #eab308; color: white; }
        .status-complete { background-color: #22c55e; color: white; }
        .status-lost { background-color: #ef4444; color: white; }

        .modal { transition: opacity 0.3s ease; }
        .modal-container { transition: transform 0.3s ease; }

        /* --- Spinner for Buttons --- */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div class="background-container"></div>

    <!-- Full Screen Loader -->
    <div id="loader-overlay" class="fixed inset-0 bg-black/60 flex items-center justify-center z-[100]" style="display: none;">
        <div class="w-16 h-16 border-4 border-dashed rounded-full animate-spin border-white"></div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="glass-container fixed top-5 right-5 z-[101] text-white px-6 py-3 transition-transform transform translate-x-[calc(100%+2rem)]"></div>
    
    <header class="glass-container rounded-none border-x-0 border-t-0">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <h1 class="text-2xl font-bold text-white">Raavi Interactive Inc.</h1>
                <div class="flex items-center gap-4">
                    <nav class="flex space-x-4">
                        <button id="tab-btn-projects" class="tab-btn py-4 px-1 border-b-2 font-medium text-sm">Project Manager</button>
                        <button id="tab-btn-tasks" class="tab-btn py-4 px-1 border-b-2 font-medium text-sm">To Do</button>
                    </nav>
                    <button id="theme-switcher" class="p-2 rounded-full bg-white/20 hover:bg-white/30 backdrop-blur-sm transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" /></svg>
                    </button>
                    <button id="logout-btn" class="text-sm font-medium text-red-400 hover:text-red-300">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <div class="main-container">
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8 text-white">
            <!-- Projects View -->
            <div id="view-projects">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <div class="flex flex-wrap justify-between items-center mb-4 gap-y-2">
                            <h2 class="text-2xl font-semibold">My Projects</h2>
                            <div id="project-filters" class="flex items-center gap-2 sm:gap-4">
                                <select id="filter-project-status" class="glass-select text-sm"><option value="all">All Statuses</option><option value="lead">Lead</option><option value="dp-in-progress">DP in progress</option><option value="bp-in-progress">BP in progress</option><option value="complete">Complete</option><option value="lost">Lost</option></select>
                                <select id="filter-project-tasks-due" class="glass-select text-sm"><option value="all">All Tasks Due</option><option value="today">Today</option><option value="tomorrow">Tomorrow</option><option value="this-week">This Week</option><option value="overdue">Overdue</option></select>
                                <button id="clear-project-filters-btn" class="text-sm text-indigo-400 hover:text-indigo-300 font-medium">Clear</button>
                            </div>
                        </div>
                        <div id="project-list" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                        <p id="no-projects-message" class="hidden text-center text-gray-400 mt-8">You have no projects yet. Add one to get started!</p>
                    </div>
                    <div class="glass-container p-6">
                        <h3 class="text-xl font-bold mb-4">Add New Project</h3>
                        <form id="add-project-form" class="space-y-4">
                            <div>
                                <label class="text-sm">Project Name <span class="text-red-400">*</span></label>
                                <input type="text" id="project-name" class="glass-input w-full mt-1" required>
                            </div>
                            <div>
                                <label class="text-sm">Client Name <span class="text-red-400">*</span></label>
                                <input type="text" id="project-client-name" class="glass-input w-full mt-1" required>
                            </div>
                            <div>
                                <label class="text-sm">Project Address <span class="text-red-400">*</span></label>
                                <input type="text" id="project-address" class="glass-input w-full mt-1" required>
                            </div>
                            <div>
                                <label class="text-sm">Client Phone <span class="text-red-400">*</span></label>
                                <input type="tel" id="project-client-phone" class="glass-input w-full mt-1" required>
                            </div>
                            <div>
                                <label class="text-sm">Client Email <span class="text-red-400">*</span></label>
                                <input type="email" id="project-client-email" class="glass-input w-full mt-1" required>
                            </div>
                            <div>
                                <label class="text-sm">Status</label>
                                <select id="project-status" class="glass-select w-full mt-1"><option value="lead" selected>Lead</option><option value="dp-in-progress">DP in progress</option><option value="bp-in-progress">BP in progress</option><option value="complete">Complete</option><option value="lost">Lost</option></select>
                            </div>
                            <div>
                                <label class="text-sm">Project Value ($)</label>
                                <input type="number" id="project-value" class="glass-input w-full mt-1">
                            </div>
                            <div>
                                <label class="text-sm">Initial Note</label>
                                <textarea id="project-notes" rows="3" class="glass-textarea w-full mt-1"></textarea>
                            </div>
                            <button type="submit" class="w-full bg-white/90 text-gray-800 font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105">Add Project</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- All Tasks View -->
            <div id="view-tasks" class="hidden">
                 <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <div class="flex flex-wrap justify-between items-center mb-4 gap-y-2">
                            <h2 class="text-2xl font-semibold">All Tasks</h2>
                            <div id="task-filters" class="flex items-center gap-2 sm:gap-4">
                                <select id="filter-project" class="glass-select text-sm"><option value="all">All Projects</option></select>
                                <select id="filter-priority" class="glass-select text-sm"><option value="all">All Priorities</option><option value="1">High</option><option value="2">Medium</option><option value="3">Low</option></select>
                                <select id="filter-date" class="glass-select text-sm"><option value="all">All Due Dates</option><option value="today">Today</option><option value="this-week">This Week</option><option value="overdue">Overdue</option></select>
                                <button id="clear-filters-btn" class="text-sm text-indigo-400 hover:text-indigo-300 font-medium">Clear</button>
                            </div>
                        </div>
                        <div id="task-list" class="space-y-4"></div>
                        <p id="no-tasks-message" class="hidden text-center text-gray-400 mt-8">No tasks found. Add a task to see it here.</p>
                    </div>
                    <div class="glass-container p-6">
                        <h3 class="text-xl font-bold mb-4">Add New Task</h3>
                        <form id="add-task-form" class="space-y-4">
                            <div>
                                <label class="text-sm">Task Title <span class="text-red-400">*</span></label>
                                <input type="text" id="task-title" class="glass-input w-full mt-1" required>
                            </div>
                            <div>
                                <label class="text-sm">Project <span class="text-red-400">*</span></label>
                                <select id="task-project-select" class="glass-select w-full mt-1"><option value="none">No Project</option></select>
                            </div>
                            <div>
                                <label class="text-sm">Due Date <span class="text-red-400">*</span></label>
                                <input type="date" id="task-due-date" class="glass-input w-full mt-1" required>
                            </div>
                            <div>
                                <label class="text-sm">Due Time (Optional)</label>
                                <input type="time" id="task-due-time" class="glass-input w-full mt-1">
                            </div>
                            <div>
                                <label class="text-sm">Priority <span class="text-red-400">*</span></label>
                                <select id="task-priority" class="glass-select w-full mt-1"><option value="1">High</option><option value="2" selected>Medium</option><option value="3">Low</option></select>
                            </div>
                            <button type="submit" class="w-full bg-white/90 text-gray-800 font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105">Add Task</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Single Project View -->
            <div id="view-single-project" class="hidden">
                <button id="back-to-projects-btn" class="mb-6 inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg shadow-sm text-gray-800 bg-white/90 hover:bg-white/80 font-bold">&larr; Back to All Projects</button>
                <div class="glass-container overflow-hidden">
                    <div id="single-project-header" class="p-6"></div>
                    <div class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 border-y border-white/20">
                        <div><h4 class="font-semibold mb-2">Project Details</h4><p><strong>Type:</strong> <span id="project-type-detail"></span></p><p><strong>Category:</strong> <span id="project-category-detail"></span></p><p><strong>Services:</strong> <span id="services-required-detail"></span></p></div>
                        <div><h4 class="font-semibold mb-2">Specifications</h4><p><strong>Area:</strong> <span id="project-area-detail"></span></p><p><strong>Possession Date:</strong> <span id="possession-date-detail"></span></p></div>
                        <div><h4 class="font-semibold mb-2">Initial Inquiry Note</h4>
                            <p id="initial-note-detail" class="text-sm bg-black/20 p-3 rounded-md"></p>
                        </div>
                    </div>
                    <div class="p-6 bg-black/10"><h4 class="text-lg font-semibold mb-4">Uploaded Files</h4><div id="project-files-list" class="space-y-2 text-sm"></div></div>
                    <div class="p-6 border-y border-white/20"><h4 class="text-lg font-semibold mb-4">Tasks for this Project</h4><div id="single-project-task-list" class="space-y-4"></div><p id="single-project-no-tasks-message" class="hidden">No tasks for this project yet.</p></div>
                    <div class="p-6 bg-black/10"><h4 class="text-lg font-semibold mb-4">Project Notes</h4><div id="project-notes-list" class="space-y-3 mb-4"></div><form id="add-note-form" class="flex gap-2"><input type="text" id="new-note-text" class="glass-input flex-grow" placeholder="Add a new note..." required><button type="submit" class="bg-white/90 text-gray-800 font-bold py-2 px-4 rounded-lg">Add Note</button></form></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="edit-project-modal" class="modal fixed inset-0 bg-black/50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="modal-container glass-container w-full max-w-lg p-6 transform scale-95 overflow-y-auto" style="max-height: 90vh;">
            <h3 class="text-xl font-bold mb-4 text-white">Edit Project</h3>
            <form id="edit-project-form" class="space-y-4">
                <input type="hidden" id="edit-project-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="edit-project-name" placeholder="Project Name" class="glass-input w-full" required>
                    <select id="edit-project-status" class="glass-select w-full"><option value="lead">Lead</option><option value="dp-in-progress">DP in progress</option><option value="bp-in-progress">BP in progress</option><option value="complete">Complete</option><option value="lost">Lost</option></select>
                    <input type="text" id="edit-project-client-name" placeholder="Client Name" class="glass-input w-full" required>
                    <input type="text" id="edit-project-client-company" placeholder="Client Company" class="glass-input w-full">
                    <input type="text" id="edit-project-address" placeholder="Project Address" class="md:col-span-2 glass-input w-full" required>
                    <input type="tel" id="edit-project-client-phone" placeholder="Client Phone" class="glass-input w-full" required>
                    <input type="email" id="edit-project-client-email" placeholder="Client Email" class="glass-input w-full" required>
                    <input type="number" id="edit-project-value" placeholder="Project Value ($)" class="glass-input w-full">
                    <input type="text" id="edit-project-type" placeholder="Project Type" class="glass-input w-full">
                    <input type="text" id="edit-project-category" placeholder="Project Category" class="glass-input w-full">
                    <input type="text" id="edit-services-required" placeholder="Services Required" class="glass-input w-full">
                    <input type="date" id="edit-possession-date" class="glass-input w-full">
                    <div class="flex"><input type="number" id="edit-project-area" placeholder="Area" class="glass-input w-2/3 rounded-r-none"><input type="text" id="edit-area-unit" placeholder="Unit" class="glass-input w-1/3 rounded-l-none"></div>
                </div>
                <!-- UPDATED: Button container layout -->
                <div class="flex justify-between items-center pt-4">
                    <button type="button" id="delete-project-btn" class="bg-red-600/80 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700/80">Delete Project</button>
                    <div class="flex gap-3">
                        <button type="button" id="cancel-edit-project-btn" class="bg-black/20 text-white font-bold py-2 px-4 rounded-md hover:bg-black/30">Cancel</button>
                        <button type="submit" class="bg-white/90 text-gray-800 font-bold py-2 px-4 rounded-lg">Save Changes</button>
                    </div>
                </div>
            </form>
        </div>
    </div> 

    <div id="edit-task-modal" class="modal fixed inset-0 bg-black/50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="modal-container glass-container w-full max-w-md p-6 transform scale-95">
            <h3 class="text-xl font-bold mb-4 text-white">Edit Task</h3>
            <form id="edit-task-form" class="space-y-4">
                <input type="hidden" id="edit-task-id">
                <input type="text" id="edit-task-title" placeholder="Task Title" class="glass-input w-full" required>
                <select id="edit-task-project-select" class="glass-select w-full"><option value="none">No Project</option></select>
                <div class="grid grid-cols-2 gap-4"><input type="date" id="edit-task-due-date" class="glass-input w-full" required><input type="time" id="edit-task-due-time" class="glass-input w-full"></div>
                <select id="edit-task-priority" class="glass-select w-full"><option value="1">High</option><option value="2">Medium</option><option value="3">Low</option></select>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" id="cancel-edit-task-btn" class="bg-black/20 text-white font-bold py-2 px-4 rounded-md hover:bg-black/30">Cancel</button>
                    <button type="submit" class="bg-white/90 text-gray-800 font-bold py-2 px-4 rounded-lg">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="confirmation-modal" class="modal fixed inset-0 bg-black/50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="modal-container glass-container w-full max-w-sm p-6 transform scale-95">
            <h3 id="confirmation-title" class="text-lg font-bold mb-2 text-white">Are you sure?</h3>
            <p id="confirmation-message" class="text-gray-300 mb-4">This action cannot be undone.</p>
            <div class="flex justify-end gap-3">
                <button id="cancel-confirmation-btn" class="bg-black/20 text-white font-bold py-2 px-4 rounded-md hover:bg-black/30">Cancel</button>
                <button id="confirm-action-btn" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg">Confirm</button>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="env.js"></script>
    <script src="shared/utils.js"></script>
    <script src="app.js"></script>
</body>
</html>