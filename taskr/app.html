<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project & Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Core Layout & Background --- */
        body { 
            font-family: 'Inter', sans-serif; 
            overflow: hidden;
            background-size: 400% 400%; 
            animation: gradientAnimation 15s ease infinite; 
            background-image: linear-gradient(45deg, #4f46e5, #9333ea, #db2777, #f59e0b);
        }
        .background-container { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh; 
            background-size: 400% 400%; 
            animation: gradientAnimation 15s ease infinite; 
            transition: background-image 0.5s ease-in-out; 
            z-index: -1; 
        }
        .theme-rainbow .background-container { background-image: linear-gradient(45deg, #4f46e5, #9333ea, #db2777, #f59e0b); }
        .theme-dark-mono .background-container { background-image: linear-gradient(45deg, #232526, #414345, #232526); }
        @keyframes gradientAnimation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        .main-container { 
            height: 100vh; 
            overflow-y: auto;
            padding-top: 4rem;
        }

        /* --- Glassmorphism Styles --- */
        .glass-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .glass-input, .glass-select, .glass-textarea {
            background: rgba(255, 255, 255, 0.15) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            color: #ffffff !important;
            border-radius: 0.375rem;
            padding-left: 0.75rem;
            padding-right: 0.75rem;
        }
        /* FIX: Prevents black text in date/time pickers on some browsers */
        .glass-input[type="date"],
        .glass-input[type="time"] {
            color-scheme: dark;
        }
        .glass-input::placeholder, .glass-textarea::placeholder { color: rgba(255, 255, 255, 0.7); }
        .glass-input:focus, .glass-select:focus, .glass-textarea:focus { box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.5); outline: none; }

        select option {
            background-color: #1f2937;
            color: #ffffff;
        }

        /* --- App-Specific Styles --- */
        header { position: fixed; top: 0; left: 0; right: 0; z-index: 50; }
        .tab-btn { color: rgba(255, 255, 255, 0.7); }
        .tab-btn.active { color: #ffffff; border-color: #ffffff; }
        .tab-btn:hover { color: #ffffff; }
        .task-item { position: relative; overflow: hidden; padding-left: 1.5rem; }
        .task-item::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 8px; }
        .task-item.priority-1::before { background-color: #ef4444; } /* High */
        .task-item.priority-2::before { background-color: #f97316; } /* Medium */
        .task-item.priority-3::before { background-color: #22c55e; } /* Low */
        .task-item.completed .task-title { text-decoration: line-through; color: rgba(255, 255, 255, 0.5); }
        .status-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
        .status-lead { background-color: #3b82f6; color: white; }
        .status-dp-in-progress { background-color: #f97316; color: white; }
        .status-bp-in-progress { background-color: #eab308; color: white; }
        .status-complete { background-color: #22c55e; color: white; }
        .status-lost { background-color: #ef4444; color: white; }
        .modal { transition: opacity 0.3s ease; }
        .modal-container { transition: transform 0.3s ease; }
        .spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Google Places dropdown styling for dark UI */
        .pac-container, .pac-item {
            z-index: 1050 !important;
            background-color: #1f2937 !important; /* slate-800 */
            color: #ffffff !important;
            border: none !important;
        }
        .pac-item:hover { background-color: rgba(255, 255, 255, 0.08) !important; }
    </style>
</head>
<body>
    
    <div id="app-content" class="opacity-0 transition-opacity duration-500">
        <div class="background-container"></div>
        <div id="notification-container" class="glass-container fixed top-5 right-5 z-[101] text-white px-6 py-3 transition-transform transform translate-x-[calc(100%+2rem)]"></div>
        
        <header class="glass-container rounded-none border-x-0 border-t-0">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <h1 class="text-2xl font-bold text-white hidden sm:block">Raavi Interactive Inc.</h1>
                    <div class="flex items-center gap-4">
                        <nav class="flex space-x-4">
                            <button id="tab-btn-projects" class="tab-btn py-4 px-1 border-b-2 font-medium text-sm">Project Manager</button>
                            <button id="tab-btn-tasks" class="tab-btn py-4 px-1 border-b-2 font-medium text-sm">To Do</button>
                        </nav>
                        <button id="theme-switcher" class="p-2 rounded-full bg-white/20 hover:bg-white/30 backdrop-blur-sm transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" /></svg>
                        </button>
                        <button id="logout-btn" class="text-sm font-medium text-red-400 hover:text-red-300">Logout</button>
                    </div>
                </div>
            </div>
        </header>

        <div class="main-container">
            <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-white">
                <!-- Projects View -->
                <div id="view-projects">
                    <div class="flex flex-wrap justify-between items-center mb-4 gap-y-2">
                        <h2 class="text-2xl font-semibold">My Projects</h2>
                        <div id="project-filters" class="flex flex-wrap items-center gap-2 sm:gap-4">
                            <select id="filter-project-status" class="glass-select text-sm"><option value="all">All Statuses</option><option value="lead">Lead</option><option value="dp-in-progress">DP in progress</option><option value="bp-in-progress">BP in progress</option><option value="complete">Complete</option><option value="lost">Lost</option></select>
                            <select id="filter-project-tasks-due" class="glass-select text-sm"><option value="all">All Tasks Due</option><option value="today">Today</option><option value="tomorrow">Tomorrow</option><option value="this-week">This Week</option><option value="overdue">Overdue</option></select>
                            <button id="clear-project-filters-btn" class="text-sm text-indigo-400 hover:text-indigo-300 font-medium">Clear</button>
                        </div>
                    </div>
                    <div id="project-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                    <p id="no-projects-message" class="hidden text-center text-gray-400 mt-8">You have no projects yet. Add one to get started!</p>
                </div>

                <!-- Tasks (To Do) View -->
                <div id="view-tasks" class="hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2">
                            <div class="flex flex-wrap justify-between items-center mb-4 gap-y-2">
                                <h2 class="text-2xl font-semibold">All Tasks</h2>
                                <div id="task-filters" class="flex flex-wrap items-center gap-2 sm:gap-4">
                                    <select id="filter-project" class="glass-select text-sm"><option value="all">All Projects</option></select>
                                    <select id="filter-priority" class="glass-select text-sm"><option value="all">All Priorities</option><option value="1">High</option><option value="2">Medium</option><option value="3">Low</option></select>
                                    <select id="filter-date" class="glass-select text-sm"><option value="all">All Due Dates</option><option value="today">Today</option><option value="this-week">This Week</option><option value="overdue">Overdue</option></select>
                                    <button id="clear-filters-btn" class="text-sm text-indigo-400 hover:text-indigo-300 font-medium">Clear</button>
                                </div>
                            </div>
                            <div id="task-list" class="space-y-4"></div>
                            <p id="no-tasks-message" class="hidden text-center text-gray-400 mt-8">No tasks found. Add a task to see it here.</p>
                        </div>
                        <!-- Quote of the Day Container -->
                        <div class="glass-container p-6 flex flex-col items-center justify-center text-center">
                            <h3 class="text-xl font-bold mb-4">Quote of the Day</h3>
                            <blockquote class="text-lg italic text-white/90">
                                "The value of an idea lies in the using of it."
                            </blockquote>
                            <cite class="block text-right mt-4 text-white/70 w-full">- Thomas Edison</cite>
                        </div>
                    </div>
                </div>
                
                <!-- Single Project Detail View -->
                <div id="view-single-project" class="hidden">
                    <button id="back-to-projects-btn" class="mb-6 inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg shadow-sm text-gray-800 bg-white/90 hover:bg-white/80 font-bold">&larr; Back to All Projects</button>
                    <div class="glass-container overflow-hidden">
                        <div id="single-project-header" class="p-6"></div>
                        <div class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 border-y border-white/20">
                            <div><h4 class="font-semibold mb-2">Project Details</h4><p><strong>Type:</strong> <span id="project-type-detail"></span></p><p><strong>Category:</strong> <span id="project-category-detail"></span></p><p><strong>Services:</strong> <span id="services-required-detail"></span></p></div>
                            <div><h4 class="font-semibold mb-2">Specifications</h4><p><strong>Area:</strong> <span id="project-area-detail"></span></p><p><strong>Possession Date:</strong> <span id="possession-date-detail"></span></p></div>
                            <div><h4 class="font-semibold mb-2">Initial Inquiry Note</h4><p id="initial-note-detail" class="text-sm bg-black/20 p-3 rounded-md"></p></div>
                        </div>
                        <div class="p-6 bg-black/10"><h4 class="text-lg font-semibold mb-4">Uploaded Files</h4><div id="project-files-list" class="space-y-2 text-sm"></div></div>
                        <div class="p-6 border-y border-white/20"><h4 class="text-lg font-semibold mb-4">Tasks for this Project</h4><div id="single-project-task-list" class="space-y-4"></div><p id="single-project-no-tasks-message" class="hidden">No tasks for this project yet.</p></div>
                        <div class="p-6 bg-black/10"><h4 class="text-lg font-semibold mb-4">Project Notes</h4><div id="project-notes-list" class="space-y-3 mb-4"></div><form id="add-note-form" class="flex gap-2"><input type="text" id="new-note-text" class="glass-input flex-grow" placeholder="Add a new note..." required><button type="submit" class="bg-white/90 text-gray-800 font-bold py-2 px-4 rounded-lg">Add Note</button></form></div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Floating Action Button (FAB) -->
    <button id="fab-add-button" class="glass-container fixed bottom-8 right-8 w-16 h-16 rounded-full flex items-center justify-center shadow-lg transition-transform transform hover:scale-110 z-50">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
    </button>

    <!-- MODALS SECTION -->

    <!-- Add Project Modal -->
    <div id="add-project-modal" class="modal fixed inset-0 bg-black/50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="modal-container glass-container w-full max-w-lg p-6 transform scale-95 overflow-y-auto" style="max-height: 90vh;">
            <h3 class="text-xl font-bold mb-4 text-white">Add New Project</h3>
            <form id="add-project-form" class="space-y-4 text-white">
                <div><label class="text-sm">Project Name <span class="text-red-400">*</span></label><input type="text" id="project-name" class="glass-input w-full mt-1" required></div>
                <div><label class="text-sm">Client Name <span class="text-red-400">*</span></label><input type="text" id="project-client-name" class="glass-input w-full mt-1" required></div>
                <div>
                    <label class="text-sm">Project Address <span class="text-red-400">*</span></label>
                    <div class="flex gap-2 mt-1">
                        <input type="text" id="project-address" class="glass-input flex-grow" required>
                        <button type="button" id="add-show-maps-btn" class="px-3 py-2 rounded-md bg-white/90 text-gray-800 font-bold">Show on Maps</button>
                    </div>
                    <label class="flex items-center gap-2 mt-2 text-xs text-gray-200"><input type="checkbox" id="project-address-manual" class="accent-white"> Enter manually (disable suggestions)</label>
                </div>
                <div><label class="text-sm">Client Phone <span class="text-red-400">*</span></label><input type="tel" id="project-client-phone" class="glass-input w-full mt-1" required></div>
                <div><label class="text-sm">Client Email <span class="text-red-400">*</span></label><input type="email" id="project-client-email" class="glass-input w-full mt-1" required></div>
                <div><label class="text-sm">Status</label><select id="project-status" class="glass-select w-full mt-1"><option value="lead" selected>Lead</option><option value="dp-in-progress">DP in progress</option><option value="bp-in-progress">BP in progress</option><option value="complete">Complete</option><option value="lost">Lost</option></select></div>
                <div>
                    <label class="text-sm">Project Value</label>
                    <div class="relative mt-1">
                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-white/80">$</span>
                        <input type="number" id="project-value" class="glass-input w-full pl-7" />
                    </div>
                </div>
                <div>
                    <label class="text-sm">Project Type</label>
                    <select id="project-type" class="glass-select w-full mt-1">
                        <option value="">Project Type</option>
                        <option value="Residential">Residential</option>
                        <option value="Commercial">Commercial</option>
                        <option value="Rezoning">Rezoning</option>
                    </select>
                </div>
                <div>
                    <label class="text-sm">Project Category</label>
                    <select id="project-category" class="glass-select w-full mt-1">
                        <option value="">Project Category</option>
                    </select>
                </div>
                <div>
                    <label class="text-sm">Services Required</label>
                    <select id="services-required" class="glass-select w-full mt-1">
                        <option value="">Services Required</option>
                        <option value="Everything">Everything</option>
                        <option value="BP (Building Permit)">BP (Building Permit)</option>
                        <option value="DP (Development Permit)">DP (Development Permit)</option>
                        <option value="Architectural">Architectural</option>
                        <option value="Mechanical">Mechanical</option>
                        <option value="Structural">Structural</option>
                    </select>
                </div>
                <div>
                    <label class="text-sm">Area & Unit</label>
                    <div class="flex mt-1">
                        <input type="number" id="project-area" placeholder="Area" class="glass-input w-2/3 rounded-r-none">
                        <select id="area-unit" class="glass-select w-1/3 rounded-l-none">
                            <option value="sq ft" selected>ft²</option>
                            <option value="sq m">m²</option>
                        </select>
                    </div>
                </div>
                <div><label class="text-sm">Initial Note</label><textarea id="project-notes" rows="3" class="glass-textarea w-full mt-1"></textarea></div>
                <div class="flex justify-end gap-3 pt-4"><button type="button" id="cancel-add-project-btn" class="bg-black/20 text-white font-bold py-2 px-4 rounded-md hover:bg-black/30">Cancel</button><button type="submit" class="bg-white/90 text-gray-800 font-bold py-2 px-4 rounded-lg">Add Project</button></div>
            </form>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div id="add-task-modal" class="modal fixed inset-0 bg-black/50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="modal-container glass-container w-full max-w-md p-6 transform scale-95">
            <h3 class="text-xl font-bold mb-4 text-white">Add New Task</h3>
            <form id="add-task-form" class="space-y-4 text-white">
                <div><label class="text-sm">Task Title <span class="text-red-400">*</span></label><input type="text" id="task-title" class="glass-input w-full mt-1" required></div>
                <div><label class="text-sm">Project</label><select id="task-project-select" class="glass-select w-full mt-1"><option value="none">No Project</option></select></div>
                <div><label class="text-sm">Due Date <span class="text-red-400">*</span></label><input type="date" id="task-due-date" class="glass-input w-full mt-1" required></div>
                <div><label class="text-sm">Due Time (Optional)</label><input type="time" id="task-due-time" class="glass-input w-full mt-1"></div>
                <div><label class="text-sm">Priority <span class="text-red-400">*</span></label><select id="task-priority" class="glass-select w-full mt-1"><option value="1">High</option><option value="2" selected>Medium</option><option value="3">Low</option></select></div>
                <div class="flex justify-end gap-3 pt-4"><button type="button" id="cancel-add-task-btn" class="bg-black/20 text-white font-bold py-2 px-4 rounded-md hover:bg-black/30">Cancel</button><button type="submit" class="bg-white/90 text-gray-800 font-bold py-2 px-4 rounded-lg">Add Task</button></div>
            </form>
        </div>
    </div>

    <!-- Edit Project Modal -->
    <div id="edit-project-modal" class="modal fixed inset-0 bg-black/50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="modal-container glass-container w-full max-w-lg p-6 transform scale-95 overflow-y-auto" style="max-height: 90vh;">
            <h3 class="text-xl font-bold mb-4 text-white">Edit Project</h3>
            <form id="edit-project-form" class="space-y-4">
                <input type="hidden" id="edit-project-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="edit-project-name" placeholder="Project Name" class="glass-input w-full" required>
                    <select id="edit-project-status" class="glass-select w-full"><option value="lead">Lead</option><option value="dp-in-progress">DP in progress</option><option value="bp-in-progress">BP in progress</option><option value="complete">Complete</option><option value="lost">Lost</option></select>
                    <input type="text" id="edit-project-client-name" placeholder="Client Name" class="glass-input w-full" required>
                    <input type="text" id="edit-project-client-company" placeholder="Client Company" class="glass-input w-full">
                    <div class="md:col-span-2">
                        <div class="flex gap-2">
                            <input type="text" id="edit-project-address" placeholder="Project Address" class="glass-input flex-grow" required>
                            <button type="button" id="edit-show-maps-btn" class="px-3 py-2 rounded-md bg-white/90 text-gray-800 font-bold">Show on Maps</button>
                        </div>
                        <label class="flex items-center gap-2 mt-2 text-xs text-gray-200"><input type="checkbox" id="edit-project-address-manual" class="accent-white"> Enter manually (disable suggestions)</label>
                    </div>
                    <input type="tel" id="edit-project-client-phone" placeholder="Client Phone" class="glass-input w-full" required>
                    <input type="email" id="edit-project-client-email" placeholder="Client Email" class="glass-input w-full" required>
                    <div>
                        <label class="sr-only">Project Value</label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-white/80">$</span>
                            <input type="number" id="edit-project-value" placeholder="Project Value" class="glass-input w-full pl-7">
                        </div>
                    </div>
                    <select id="edit-project-type" class="glass-select w-full">
                        <option value="">Project Type</option>
                        <option value="Residential">Residential</option>
                        <option value="Commercial">Commercial</option>
                        <option value="Rezoning">Rezoning</option>
                    </select>
                    <select id="edit-project-category" class="glass-select w-full">
                        <option value="">Project Category</option>
                    </select>
                    <select id="edit-services-required" class="glass-select w-full">
                        <option value="">Services Required</option>
                        <option value="Everything">Everything</option>
                        <option value="BP (Building Permit)">BP (Building Permit)</option>
                        <option value="DP (Development Permit)">DP (Development Permit)</option>
                        <option value="Architectural">Architectural</option>
                        <option value="Mechanical">Mechanical</option>
                        <option value="Structural">Structural</option>
                    </select>
                    <input type="date" id="edit-possession-date" class="glass-input w-full">
                    <div class="flex">
                        <input type="number" id="edit-project-area" placeholder="Area" class="glass-input w-2/3 rounded-r-none">
                        <select id="edit-area-unit" class="glass-select w-1/3 rounded-l-none">
                            <option value="sq ft">ft²</option>
                            <option value="sq m">m²</option>
                        </select>
                    </div>
                </div>
                <div class="flex justify-between items-center pt-4"><button type="button" id="delete-project-btn" class="bg-red-600/80 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700/80">Delete Project</button><div class="flex gap-3"><button type="button" id="cancel-edit-project-btn" class="bg-black/20 text-white font-bold py-2 px-4 rounded-md hover:bg-black/30">Cancel</button><button type="submit" class="bg-white/90 text-gray-800 font-bold py-2 px-4 rounded-lg">Save Changes</button></div></div>
            </form>
        </div>
    </div> 

    <!-- Edit Task Modal -->
    <div id="edit-task-modal" class="modal fixed inset-0 bg-black/50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="modal-container glass-container w-full max-w-md p-6 transform scale-95">
            <h3 class="text-xl font-bold mb-4 text-white">Edit Task</h3>
            <form id="edit-task-form" class="space-y-4">
                <input type="hidden" id="edit-task-id">
                <input type="text" id="edit-task-title" placeholder="Task Title" class="glass-input w-full" required>
                <select id="edit-task-project-select" class="glass-select w-full"><option value="none">No Project</option></select>
                <div class="grid grid-cols-2 gap-4"><input type="date" id="edit-task-due-date" class="glass-input w-full" required><input type="time" id="edit-task-due-time" class="glass-input w-full"></div>
                <select id="edit-task-priority" class="glass-select w-full"><option value="1">High</option><option value="2">Medium</option><option value="3">Low</option></select>
                <div class="flex justify-end gap-3 pt-4"><button type="button" id="cancel-edit-task-btn" class="bg-black/20 text-white font-bold py-2 px-4 rounded-md hover:bg-black/30">Cancel</button><button type="submit" class="bg-white/90 text-gray-800 font-bold py-2 px-4 rounded-lg">Save Changes</button></div>
            </form>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="modal fixed inset-0 bg-black/50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="modal-container glass-container w-full max-w-sm p-6 transform scale-95">
            <h3 id="confirmation-title" class="text-lg font-bold mb-2 text-white">Are you sure?</h3>
            <p id="confirmation-message" class="text-gray-300 mb-4">This action cannot be undone.</p>
            <div class="flex justify-end gap-3"><button id="cancel-confirmation-btn" class="bg-black/20 text-white font-bold py-2 px-4 rounded-md hover:bg-black/30">Cancel</button><button id="confirm-action-btn" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg">Confirm</button></div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="shared/utils.js"></script>
    <script src="app.js"></script>
</body>
</html>
