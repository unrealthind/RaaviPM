Raavi PM - Project Management & Client Intake System

1. Project Introduction
Welcome to Raavi PM! This is a complete system for managing client projects from initial contact to completion. It consists of two primary front-end applications:

Intake Form (/form): A public-facing, multi-step web form designed to capture detailed information from new clients, including project requirements, contact details, and file uploads.

Project Manager (/taskr): A secure, login-protected dashboard for internal use. It allows you to view and manage all client projects, track tasks, add notes, and monitor project status.

The two applications are designed to work together seamlessly. When a potential client fills out the intake form, a new project is automatically created in the project manager with a "Lead" status, creating an efficient and streamlined workflow for client onboarding.

2. Project Setup & Structure
This project is organized as a monorepo, containing multiple applications within a single repository.

Folder Structure
/RaaviPM/
├── /form/              # Contains the client intake form application
│   ├── app.html
│   ├── app.js
│   ├── env.js          # Local environment variables (ignored by Git)
│   └── /shared/
│       └── utils.js    # Synced copy of shared code
│
├── /taskr/             # Contains the project manager application
│   ├── app.html
│   ├── app.js
│   ├── login.html
│   ├── login.js
│   ├── index.html
│   ├── env.js          # Local environment variables (ignored by Git)
│   └── /shared/
│       └── utils.js    # Synced copy of shared code
│
├── /shared/            # The "source of truth" for shared code
│   └── utils.js
│
├── .gitignore          # Ignores node_modules and all env.js files
├── env.js              # Example environment file (do not fill with secrets)
└── sync.js             # Node.js script to sync shared code

3. How to Use sync.js
Because both applications share common logic (like the Supabase client and theme switcher), we need a way to manage this code without duplicating it.

What it Does
The sync.js script reads the content from the central /shared/utils.js file and copies it into the local /shared/ folder of both the form and taskr applications.

Why it's Necessary
This process allows each application to be self-contained and deployable on its own server or port, while ensuring that any updates to the shared logic only need to be made in one place.

How to Run it
Make sure you have Node.js installed.

Open your terminal in the root RaaviPM/ directory.

Whenever you make a change to /shared/utils.js, run the following command:

node sync.js

This will instantly update the copies in both the form and taskr directories.

4. The utils.js File
The /shared/utils.js file is the central hub for code used by both applications. It contains:

Supabase Client Initialization: It reads your API keys from window.APP_CONFIG (provided by env.js) and creates a global _supabase client instance that all other scripts can use to communicate with your database.

Universal Theme Switcher (setupThemeSwitcher): A function that, when called, finds a button by its ID and attaches all the necessary logic to handle theme switching and saving the user's preference to local storage.

5. Supabase Setup Guide
Follow these steps to configure your backend on Supabase.

Step A: Create the Project
Go to supabase.com and create a new project.

Once created, navigate to Project Settings > API.

Find your Project URL and anon (public) key. You will need these for your env.js files.

Step B: Create Local env.js Files
You need to create two env.js files, one for each application.

taskr/env.js:

window.APP_CONFIG = {
  supabaseUrl: 'YOUR_SUPABASE_URL',
  supabaseKey: 'YOUR_SUPABASE_ANON_KEY'
};

form/env.js:

window.APP_CONFIG = {
  supabaseUrl: 'YOUR_SUPABASE_URL',
  supabaseKey: 'YOUR_SUPABASE_ANON_KEY',
  googleApiKey: 'YOUR_GOOGLE_MAPS_API_KEY'
};

IMPORTANT: Your root .gitignore file is already configured to ignore any file named env.js, so your keys will not be committed to your repository.

Step C: Run the Database Setup Script
The following SQL script will create your tables, set up relationships, enable Row Level Security, and create the necessary security policies.

In your Supabase project, go to the SQL Editor.

Click New query.

Copy the entire script below and paste it into the SQL Editor.

Click Run.

-- Raavi PM Supabase Setup Script

-- ========= TABLE CREATION =========

-- 1. Create the 'projects' table
-- This table stores all project information, whether from the intake form or created internally.
CREATE TABLE public.projects (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  name text NOT NULL,
  client_name text,
  client_company text,
  client_phone text,
  client_email text,
  address text,
  status text DEFAULT 'lead'::text,
  value numeric,
  project_type text,
  project_category text,
  services_required text,
  possession_date date,
  project_area numeric,
  area_unit text,
  other_info text,
  uploaded_files jsonb,
  notes jsonb,
  user_id uuid REFERENCES auth.users(id) ON DELETE SET NULL
);
COMMENT ON TABLE public.projects IS 'Stores all project details and client information.';

-- 2. Create the 'tasks' table
-- This table stores tasks, which are linked to projects.
CREATE TABLE public.tasks (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  title text NOT NULL,
  due_date date,
  due_time time without time zone,
  priority smallint DEFAULT 2,
  completed boolean DEFAULT false,
  project_id bigint REFERENCES public.projects(id) ON DELETE CASCADE,
  user_id uuid REFERENCES auth.users(id) ON DELETE SET NULL
);
COMMENT ON TABLE public.tasks IS 'Stores individual tasks related to projects.';


-- ========= STORAGE SETUP =========

-- 1. Create the storage bucket for project files
-- The intake form uploads files here. Set to public for easy access via URLs.
INSERT INTO storage.buckets (id, name, public)
VALUES ('project-files', 'project-files', true)
ON CONFLICT (id) DO NOTHING;

-- Create policies for the storage bucket
-- Allow anonymous users (like from the intake form) to upload files.
CREATE POLICY "Allow anonymous uploads" ON storage.objects
FOR INSERT TO public
WITH CHECK (bucket_id = 'project-files');

-- Allow anyone to view the uploaded files.
CREATE POLICY "Allow public reads" ON storage.objects
FOR SELECT TO public
USING (bucket_id = 'project-files');


-- ========= SECURITY & POLICIES =========

-- 1. Enable Row Level Security (RLS) on both tables
ALTER TABLE public.projects ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.tasks ENABLE ROW LEVEL SECURITY;

-- 2. Create RLS Policies for the 'projects' table
-- Allow authenticated users to see their own projects OR new leads (where user_id is NULL).
CREATE POLICY "Allow users to view their own projects and new leads" ON public.projects
FOR SELECT USING (
  auth.uid() = user_id OR user_id IS NULL
);

-- Allow users to insert new projects for themselves.
CREATE POLICY "Allow users to create their own projects" ON public.projects
FOR INSERT WITH CHECK (auth.uid() = user_id);

-- Allow users to update only their own projects.
CREATE POLICY "Allow users to update their own projects" ON public.projects
FOR UPDATE USING (auth.uid() = user_id);

-- Allow users to delete only their own projects.
CREATE POLICY "Allow users to delete their own projects" ON public.projects
FOR DELETE USING (auth.uid() = user_id);

-- 3. Create RLS Policies for the 'tasks' table
-- Allow users to view tasks associated with projects they can see.
CREATE POLICY "Allow users to view tasks for their projects" ON public.tasks
FOR SELECT USING (
  EXISTS (
    SELECT 1 FROM projects
    WHERE projects.id = tasks.project_id
  )
);

-- Allow users to insert tasks for themselves.
CREATE POLICY "Allow users to create their own tasks" ON public.tasks
FOR INSERT WITH CHECK (auth.uid() = user_id);

-- Allow users to update only their own tasks.
CREATE POLICY "Allow users to update their own tasks" ON public.tasks
FOR UPDATE USING (auth.uid() = user_id);

-- Allow users to delete only their own tasks.
CREATE POLICY "Allow users to delete their own tasks" ON public.tasks
FOR DELETE USING (auth.uid() = user_id);


6. Deployment

(Running as a Service)
Since you have two separate front-end applications, you will need to deploy them individually.

Choose a Host: Use a static site hosting service like Netlify, Vercel, or GitHub Pages.

Deploy the form App:

Create a new site on your host and connect it to your repository.

Set the base directory to form.

Set the build command to empty (or npm run build if you add a build step later).

Set the publish directory to form.

Environment Variables: You will need to add your Supabase and Google Maps keys as environment variables in your host's settings. Your application will need to be modified slightly to read these instead of from a local env.js file for production.

Deploy the taskr App:

Create another new site on your host.

Set the base directory to taskr.

Set the publish directory to taskr.

Environment Variables: Add your Supabase keys here as well.

This setup will give you two different URLs, one for your public-facing form and one for your private project manager.